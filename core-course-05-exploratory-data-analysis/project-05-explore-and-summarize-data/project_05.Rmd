---
output: github_document
---
EDA in an Issue Tracking Data Set
================================================================================
*by Dannyel Cardoso da Fonseca* 

<style>
body {
  text-align: justify
}
pre code, pre, code {
  white-space: pre !important;
  overflow-x: auto !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
</style>

```{r setup, include=FALSE}
# https://stackoverflow.com/a/38579910/8645131
knitr::opts_chunk$set(echo = TRUE)
options(width=200)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Cleaning the environment before start
# This is useful when execute "Restart R and Run All Chuncks"
rm(list = ls())
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Load Packages"}
library(ggplot2)
library(dplyr)
library(lubridate)
library(grid)

source("project_05.R")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Set Up"}
# NOTE: To run this notebook set up current work directory to this file location

# Set up default theme for plots
theme_set(theme_classic() %+replace%
            theme(panel.grid.major.y = element_line(size=.05, color="gray"),
                  plot.margin = unit(c(1, .5, 1, 2), "cm")))
```

```{r echo=FALSE, "Load Data Set"}
issues <- load_dataset("issues_tracking.csv")
```

This project aims to explore a data set containing 22,125 observations of issues 
tracking and their history logs. The data set represents 5 years of project 
management which aimed maintenance and customization of many integrated systems
([SIG](https://docs.info.ufrn.br)) for the academic, administrative and human 
resources management at the Universidade Federal de GoiÃ¡s ([UFG](https://www.ufg.br)).

A proprietary issue tracking system ([SIGProject](https://sigproject.esig.com.br)) 
was used to manage activities of teams.

![Screenshot](project_05_files/screenshot-sigproject.esig.com.br-2018.02.25-11-25-48.png)

I used data wrangling techniques to export data from that and clean them. The 
final data set, used in this project, and its documentation can be accessed, 
respectively, in these links: 

- [Issues Data Set](issues_tracking.csv)
- [Issues Data Set Documentation](issues_tracking.Rdoc.txt)

The exported data set, the wrangling process scripts and an example of one issue 
tracking can be find in [data_wrangling](data_wrangling) folder. 

# Data Set Summaries

In this section I perform some preliminary exploration on the data set, analyzing 
its structure and the distributions of some variables.

### Data Set Structure

The issues data set contains 22,125 rows and 24 variables. Of these 24 variables 
16 are about issue data and 8 about issue's logs.

```{r echo=FALSE, message=FALSE, warning=FALSE, "Structure of the Data Set"}
# Show the issues' dataframe structure
str(issues, max.level=1, vec.len=1, nchar.max=50)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Support Dataframe to Plot (1)"}
# From issues dataframe, it was created another dataframe which counts number of 
# logs per issue_id
df_number_logs_per_issue <- 
  issues %>%
    select(issue_id, log_creation_date) %>%
    group_by(issue_id) %>% 
    summarise(score = sum(!is.na(log_creation_date))) %>% 
    as.data.frame()
```

The number of distinct issues rows and issue's logs rows are 4,503 and 21,978
respectively.

```{r echo=FALSE, message=FALSE, warning=FALSE, "Number of issues and issue's logs"}
data.frame(number_issues = nrow(df_number_logs_per_issue), 
           number_logs = sum(df_number_logs_per_issue$score))
```
We can note that the number of issues represents 20% of the data set and the 
number of logs represents 99% of it. The 1% of logs remaining (147 rows) represents 
issues that do not have history logs. The distribution of number of logs per issue 
and their summaries are presented in the histogram below.

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Logs per Issue"}
summ_number_logs_per_issue <- df_summary(df_number_logs_per_issue, score)
# Count number of issues for each number of logs per issue

plot_number_logs_per_issue <-
  df_number_logs_per_issue %>% 
    ggplot(aes(x = score)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_number_logs_per_issue$min, 
                     closed = "left") +
      plot_summary(df_number_logs_per_issue, score) +
      scale_x_continuous(breaks = seq(0, 43, 2)) +
      scale_y_continuous(breaks = seq(0, 800, 50)) +
      labs(title = "Distribution of Number of Logs per Issue",
           subtitle = text_df_summary(summ_number_logs_per_issue),
           x = "Number of logs per issue",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_number_logs_per_issue))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_number_logs_per_issue
```

Analysing the plot above, we can note that 75% of issues have up to 6 history logs
(before 3rd quartile) and 50% of issues have between 2 and 6 logs (between 1st 
and 3rd quartile). Besides the skewed shape of plot, the median and mean are very 
close. This means that the amount of ouliers, after 12 logs per issue, is low, 
approximately 5% of issues.  

### Issue Creation Date

This data set comprises issues created in the period between 05/21/2013 and 
01/26/2018.

```{r echo=FALSE, message=FALSE, warning=FALSE, "Start and End Issue's Creation Date"}
data.frame(first_issue_creation_date = format(min(issues$issue_creation_date), 
                                              "%m/%d/%Y %H:%M:%S"), 
           last_issue_creation_date = format(max(issues$issue_creation_date), 
                                              "%m/%d/%Y %H:%M:%S"))
```

The distribution of number of issues created by month and the cumulative summaries 
are presented in the barplot below. 

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Issues Created per Month"}
df_issue_created_by_month <- 
  issues %>% 
    distinct(issue_id, 
             issue_creation_date = as.Date(floor_date(issue_creation_date,
                                                      "month")))

df_score_issue_created_by_month <- 
  df_issue_created_by_month %>% 
    group_by(issue_creation_date) %>% 
    summarise(score = n())

summ_issue_created_by_month <- df_summary(df_score_issue_created_by_month, score)
  
plot_score_issue_created_by_month <-
  df_score_issue_created_by_month %>% 
    ggplot(aes(x = issue_creation_date, y = score)) +
      geom_col(alpha = .3, color = "grey", width = 28) +
      plot_cumsummary(df_score_issue_created_by_month, 
                      x = issue_creation_date,
                      y = score) +
      scale_x_date(date_breaks = "2 month", date_labels = "%b %Y",
                   limits = c(min(df_score_issue_created_by_month$issue_creation_date), 
                              max(df_score_issue_created_by_month$issue_creation_date) + 
                                  months(2))) +
      scale_y_continuous(breaks = seq(0, 190, 15)) +
      labs(title = "Distribution of Number of Issues Created per Month",
           subtitle = paste("", text_df_summary(summ_issue_created_by_month)),
           x = "Issue creation date (per month)",
           y = "Frequency",
           caption = paste0("\nNumber of observations: ", 
                            nrow(df_issue_created_by_month))) +
      theme(axis.text.x = element_text(angle = 40, hjust = 1)) 

plot_score_issue_created_by_month
```

Analysing the plot above, we note that the year 2013 had the lowest demand. The
accumulated mean (red solid line) variates between 10 and 20 issues per month. At 
the end of 2013 and begin of 2014 there was a drop in activities because of the 
low administrative and academic activities at the university in this period. From
April of 2014 until February of 2015 there was significant growth in activities.
The accumulated mean increases from 10 to 70 issues per month. The accumulated mean
overcame the accumulated median and the distance between accumulated 3rd quartile 
and accumulated median became greater than distance between accumulated 1st 
quartile and accumulated median. This means that theses months had a high number 
of issues created in relation to the past. 

But from August of 2015 the pace of growth dropped. Now, we can note that the 
distance between accumulated 1st quartile and accumulated median becomes greater 
than distance between accumulated 3rd quartile and accumulated median. This 
invertion provocated the overlap between accumulated mean and accumulated median. 
The stabilization of growth also contributed to that. The average of growth pass 
to be only 10 monthly issues from February 2015. 

We also note that except the significant growth period (April of 2014 until 
February of 2015) the months from September to December of each year had a 
decline in activities. The reason is the low administrative and academic 
activities at the university in this period. Thus, the demand for the systems 
decreases.

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Issues Created per Weekday"}
df_issue_created_by_wday <- 
  issues %>% 
    distinct(issue_id, 
             issue_creation_wday = wday(issue_creation_date, label = TRUE))

df_score_issue_created_by_wday <- 
  df_issue_created_by_wday %>% 
    group_by(issue_creation_wday) %>% 
    summarise(score = n())

plot_score_issue_created_by_wday <- 
  df_score_issue_created_by_wday %>% 
    ggplot(aes(x = issue_creation_wday, y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_created_by_wday$score) +
      scale_y_continuous(limits = c(0, .25), breaks = seq(0, 1, .03), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issues Created per Weekday",
           x = "Weekday",
           y = "Frequency (relative)", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_created_by_wday))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_score_issue_created_by_wday
```

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Issues Created per Hour of the Day"}
df_issue_created_by_hour <- 
  issues %>% 
    distinct(issue_id, 
             issue_creation_hour = hour(issue_creation_date))

summ_number_issue_created_by_hour <- df_summary(df_issue_created_by_hour, 
                                                issue_creation_hour)

plot_issue_created_by_hour <-
  df_issue_created_by_hour %>% 
    ggplot(aes(x = issue_creation_hour)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_number_issue_created_by_hour$min, 
                     closed = "left") +
      plot_summary(df_issue_created_by_hour, issue_creation_hour) +
      scale_x_continuous(breaks = seq(0, 23, 1)) +
      scale_y_continuous(limits = c(0, 700), breaks = seq(0, 700, 50)) +
      labs(title = "Distribution of Number of Issues Created per Hour of the Day",
           subtitle = text_df_summary(summ_number_issue_created_by_hour),
           x = "Hour of the day",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_created_by_hour))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_created_by_hour
```

### Issue Start Date

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Issues Started per Month"}
df_issue_start_date_month <- 
  subset(issues, !is.na(issue_start_date)) %>% 
    distinct(issue_id, 
             issue_start_date = as.Date(floor_date(issue_start_date,
                                                   "month")))

df_score_issue_start_date_month <- 
  df_issue_start_date_month %>% 
    group_by(issue_start_date) %>% 
    summarise(score = n())

summ_issue_start_date_month <- df_summary(df_score_issue_start_date_month, score)

plot_score_issue_start_date_month <-   
  df_score_issue_start_date_month %>% 
    ggplot(aes(x = issue_start_date, y = score)) +
      geom_col(alpha = .3, color = "grey", width = 28) +
      plot_cumsummary(df_score_issue_start_date_month, 
                      x = issue_start_date,
                      y = score) +
      scale_x_date(date_breaks = "2 month", date_labels = "%b %Y",
                   limits = c(min(df_score_issue_start_date_month$issue_start_date), 
                              max(df_score_issue_start_date_month$issue_start_date) + 
                                  months(2))) +
      scale_y_continuous(breaks = seq(0, 185, 15)) +
      labs(title = "Distribution of Number of Issues Started per Month",
           subtitle = paste("", text_df_summary(summ_issue_start_date_month)),
           x = "Issue start date (per month)",
           y = "Frequency",
           caption = paste0("\nNumber of observations: ", 
                            nrow(df_issue_start_date_month))) +
      theme(axis.text.x = element_text(angle = 40, hjust = 1)) 

plot_score_issue_start_date_month
  
```

### Issue Deadline Date

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Issues Deadline per Month"}
df_issue_deadline_date_month <- 
  subset(issues, !is.na(issue_deadline_date)) %>% 
    distinct(issue_id, 
             issue_deadline_date = as.Date(floor_date(issue_deadline_date,
                                                   "month")))

df_score_issue_deadline_date_month <- 
  df_issue_deadline_date_month %>% 
    group_by(issue_deadline_date) %>% 
    summarise(score = n())

summ_issue_deadline_date_month <- df_summary(df_score_issue_deadline_date_month, 
                                             score)
  
plot_score_issue_deadline_date_month <- 
  df_score_issue_deadline_date_month %>% 
    ggplot(aes(x = issue_deadline_date, y = score)) +
      geom_col(alpha = .3, color = "grey", width = 28) +
      plot_cumsummary(df_score_issue_deadline_date_month, 
                      x = issue_deadline_date,
                      y = score) +
      scale_x_date(date_breaks = "2 month", date_labels = "%b %Y",
                   limits = c(min(df_score_issue_deadline_date_month$issue_deadline_date), 
                              max(df_score_issue_deadline_date_month$issue_deadline_date) + 
                                  months(2))) +
      scale_y_continuous(breaks = seq(0, 80, 5)) +
      labs(title = "Distribution of Number of Issues Deadline per Month",
           subtitle = paste("", text_df_summary(summ_issue_deadline_date_month)),
           x = "Issue deadline date (per month)",
           y = "Frequency",
           caption = paste0("\nNumber of observations: ", 
                            nrow(df_issue_deadline_date_month))) +
      theme(axis.text.x = element_text(angle = 40, hjust = 1)) 

plot_score_issue_deadline_date_month
```

### Issue Time Spent

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Time Spent in a Issue per Hour"}
df_issue_time_spent_hour <- 
  issues %>% 
    distinct(issue_id, 
             issue_time_spent = period_to_seconds(issue_time_spent) / 3600)

summ_issue_time_spent_hour <- df_summary(df_issue_time_spent_hour, 
                                         issue_time_spent)

plot_issue_time_spent_hour <- 
  df_issue_time_spent_hour %>% 
    ggplot(aes(x = issue_time_spent)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_issue_time_spent_hour$min, 
                     closed = "left") +
      plot_summary(df_issue_time_spent_hour, issue_time_spent) +
      scale_x_continuous(breaks = seq(0, 110, 5)) +
      scale_y_continuous(breaks = seq(0, 3000, 250)) +
      labs(title = "Distribution of Number of Time Spent in a Issue per Hour",
           subtitle = text_df_summary(summ_issue_time_spent_hour),
           x = "Hours spent",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_time_spent_hour))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_time_spent_hour
```

```{r echo=FALSE, fig.retina=3, message=FALSE, "Distribution of Number of Time Spent in a Issue per Hour (Zoomed In)"}
plot_issue_time_spent_hour + 
    scale_x_continuous(breaks = seq(0, 24, 1)) +
    scale_y_continuous(breaks = seq(0, 2700, 175)) +
    coord_cartesian(xlim = c(0, 24)) +
    labs(title = "Distribution of Number of Time Spent in a Issue per Hour (Zoomed In)")
```

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Time Spent in a Issue (Less Than 1 Hour)"}
df_issue_time_spent_min <- 
  issues %>% 
    distinct(issue_id, issue_time_spent = period_to_seconds(issue_time_spent) / 60) %>% 
    filter(issue_time_spent < 60)

summ_issue_time_spent_min <- df_summary(df_issue_time_spent_min, 
                                         issue_time_spent)

plot_issue_time_spent_min <- 
  df_issue_time_spent_min %>% 
    ggplot(aes(x = issue_time_spent)) +
      geom_histogram(binwidth = 5, color = "gray", alpha = .3, 
                     boundary = summ_issue_time_spent_min$min, 
                     closed = "left") +
      plot_summary(df_issue_time_spent_min, issue_time_spent) +
      scale_x_continuous(breaks = seq(0, 60, 5)) +
      scale_y_continuous(breaks = seq(0, 1700, 150)) +
      labs(title = "Distribution of Number of Time Spent in a Issue (Less Than 1 Hour)",
           subtitle = text_df_summary(summ_issue_time_spent_min),
           x = "Minutes spent",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_time_spent_min))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_time_spent_min
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Head Issue Time Spent"}
df_issue_time_spent_min %>% 
  group_by(issue_time_spent) %>% 
  summarise(score = sum(!is.na(issue_time_spent))) %>% 
  arrange(desc(score)) %>% 
  head() %>% 
  as.data.frame()
```

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Time Spent in a Issue (Greater Than 0)"}
df_issue_time_spent_min <- 
  issues %>% 
    distinct(issue_id, issue_time_spent = period_to_seconds(issue_time_spent) / 60) %>% 
    filter(issue_time_spent != 0 & issue_time_spent < 60)

summ_issue_time_spent_min <- df_summary(df_issue_time_spent_min, 
                                         issue_time_spent)

plot_issue_time_spent_min <- 
  df_issue_time_spent_min %>% 
    ggplot(aes(x = issue_time_spent)) +
      geom_histogram(binwidth = 10, color = "gray", alpha = .3, 
                     boundary = summ_issue_time_spent_min$min, 
                     closed = "left") +
      plot_summary(df_issue_time_spent_min, issue_time_spent) +
      scale_x_continuous(breaks = seq(6, 60, 10)) +
      scale_y_continuous(breaks = seq(0, 500, 50)) +
      labs(title = "Distribution of Number of Time Spent in a Issue (Less Than 1 Hour)",
           subtitle = text_df_summary(summ_issue_time_spent_min),
           x = "Minutes spent",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_time_spent_min))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_time_spent_min
```

```{r echo=FALSE, fig.retina=3, "Distribution of Number of Time Spent in a Issue (Greater Than 0)"}
df_issue_time_spent_hour <- 
  issues %>% 
    distinct(issue_id, 
             issue_time_spent = period_to_seconds(issue_time_spent) / 3600) %>% 
    filter(issue_time_spent != 0)

summ_issue_time_spent_hour <- df_summary(df_issue_time_spent_hour, 
                                         issue_time_spent)

plot_issue_time_spent_hour <- 
  df_issue_time_spent_hour %>% 
    ggplot(aes(x = issue_time_spent)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_issue_time_spent_hour$min, 
                     closed = "left") +
      plot_summary(df_issue_time_spent_hour, issue_time_spent) +
      scale_x_continuous(breaks = seq(0, 24, 1)) +
      scale_y_continuous(breaks = seq(0, 2700, 150)) +
      coord_cartesian(xlim = c(0, 24)) +
      labs(title = "Distribution of Number of Time Spent in a Issue (Greater Than 0)",
           subtitle = text_df_summary(summ_issue_time_spent_hour),
           x = "Hours spent",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_time_spent_hour))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_time_spent_hour
```

### Issue Type

In the issue tracking system, 4 types of issues were used to classify the 
purpose of a issue. They are:

```{r echo=FALSE, message=FALSE, warning=FALSE, "Issue Type Values"}
levels(issues$issue_type)
```

The frequency of issues created by each issue type is shown in the graph below.

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Type"}
df_issue_type <- 
  issues %>% 
    distinct(issue_id, issue_type)

df_score_issue_type <- 
  df_issue_type %>% 
    group_by(issue_type) %>% 
    summarise(score = n())

plot_score_issue_type <- 
  df_score_issue_type %>% 
    ggplot(aes(x = reorder(issue_type, -score), y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_type$score) +
      scale_y_continuous(limits = c(0, .85), breaks = seq(0, 1, .1), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issue Type",
           x = "Issue type",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_type))) +
      theme(axis.text.x = element_text(size = 7)) 

plot_score_issue_type
```

Analysing the plot above, we note that most of the issues are of the MAINTENANCE 
type (around 75%). Next comes the issues of the CUSTOMIZATION type (around 20%). 
And, with less than 0.05% comes the issues of the types DATA MIGRATION and OTHERS.
Thus, we can summarize that project management was characterized by corrective 
maintenance activities of existing systems and subsystems.

The demand for adaptation and evolution of the systems was not insignificant. 
Although the amount of CUSTOMIZATION and DATA MIGRATION issues are less than 
MAINTENANCE, they may have indirectly influenced in the creation of large volume 
of MAINTENANCE issues. Maybe, CUSTOMIZATION issues had provocated related creation 
of MAINTENANCE issues. The same is true for DATA MIGRATION. An analysis of 
issues creation timeline by system/subsystem may answer that assumption.

### Issue System

```{r echo=FALSE, fig.retina=3, "Frequency of Issue System"}
df_issue_system <-
  issues %>%
    distinct(issue_id, issue_system)

df_score_issue_system <- 
  df_issue_system %>% 
    group_by(issue_system) %>% 
    summarise(score = n())

plot_score_issue_system <- 
  df_score_issue_system %>% 
    ggplot(aes(x = reorder(issue_system, -score), y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_system$score) +
      scale_y_continuous(limits = c(0, .85), breaks = seq(0, 1, .1), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issue System",
           x = "Issue system",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_system))) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1, size = 7)) 

plot_score_issue_system
```

### Issue Subsystem

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Subsystem"}
df_issue_subsystem <-
  issues %>%
    distinct(issue_id, issue_system, issue_subsystem)

df_score_top15_issue_subsystem <- 
  df_issue_subsystem %>%
    group_by(issue_system, issue_subsystem) %>% 
    summarise(score = n()) %>% 
    arrange(desc(score)) %>% 
    ungroup() %>% 
    filter(row_number() <= 15)

plot_score_top15_issue_subsystem <- 
  df_score_top15_issue_subsystem %>% 
    ggplot(aes(x = reorder(paste0("(", issue_system, ") ", issue_subsystem), 
                           -score), 
               y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_top15_issue_subsystem$score) +
      scale_y_continuous(limits = c(0, .45), breaks = seq(0, 1, .1), 
                         labels = scales::percent) + 
      labs(title = "Frequency (Top 15) of Issue Subsystem",
           x = "Issue subsystem",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_subsystem))) +
      theme(axis.text.x = element_text(angle = 25, hjust = 1, size = 7)) 

plot_score_top15_issue_subsystem
```

### Issue Stakeholder

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Stakeholder"}
df_issue_stakeholder <-
  issues %>%
    distinct(issue_id, issue_stakeholder)

df_score_issue_stakeholder <- 
  df_issue_stakeholder %>% 
    group_by(issue_stakeholder) %>% 
    summarise(score = n())

plot_score_issue_stakeholder <- 
  df_score_issue_stakeholder %>% 
    ggplot(aes(x = reorder(issue_stakeholder, -score), y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_stakeholder$score) +
      scale_y_continuous(limits = c(0, .85), breaks = seq(0, 1, .1), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issue Stakeholder",
           x = "Issue stakeholder",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_stakeholder))) +
      theme(axis.text.x = element_text(size = 7)) 

plot_score_issue_stakeholder
```

### Issue Created By

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Created By"}
df_issue_created_by <-
  issues %>%
    distinct(issue_id, issue_stakeholder, issue_created_by)

df_score_top15_issue_created_by <- 
  df_issue_created_by %>%
    group_by(issue_stakeholder, issue_created_by) %>% 
    summarise(score = n()) %>% 
    arrange(desc(score)) %>% 
    ungroup() %>% 
    filter(row_number() <= 15) %>% 
    mutate(issue_created_by = first_last_names(issue_created_by))

plot_score_top15_issue_created_by <- 
  df_score_top15_issue_created_by %>% 
    ggplot(aes(x = reorder(paste0("(", issue_stakeholder, ") ", issue_created_by), 
                           -score), 
               y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_top15_issue_created_by$score) +
      scale_y_continuous(limits = c(0, .25), breaks = seq(0, 1, .05), 
                         labels = scales::percent) + 
      labs(title = "Frequency (Top 15) of Issue Created By",
           x = "Issue created by",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_created_by))) +
      theme(axis.text.x = element_text(angle = 25, hjust = 1, size = 7)) 

plot_score_top15_issue_created_by
```

### Issue Status

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Status"}
df_issue_status <-
  issues %>%
    distinct(issue_id, issue_status)

df_score_issue_status <- 
  df_issue_status %>% 
    group_by(issue_status) %>% 
    summarise(score = n())

plot_score_issue_status <- 
  df_score_issue_status %>% 
    ggplot(aes(x = reorder(issue_status, -score), y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_status$score) +
      scale_y_continuous(limits = c(0, 1.1), breaks = seq(0, 1, .15), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issue Stakeholder",
           x = "Issue stakeholder",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_status))) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1, size = 7)) 

plot_score_issue_status
```

### Issue Priority Number

```{r echo=FALSE, fig.retina=3, "Distribution of Priority Number per Issue"}
df_issue_priority_number <- 
  issues %>% 
    distinct(issue_id, issue_priority_number)

summ_issue_priority_number <- df_summary(df_issue_priority_number, 
                                         issue_priority_number)

plot_issue_priority_number <- 
  df_issue_priority_number %>% 
    ggplot(aes(x = issue_priority_number)) +
      geom_histogram(binwidth = 50, color = "gray", alpha = .3, 
                     boundary = summ_issue_priority_number$min, 
                     closed = "left") +
      plot_summary(df_issue_priority_number, issue_priority_number) +
      scale_x_continuous(breaks = seq(0, 999, 50)) +
      scale_y_continuous(breaks = seq(0, 2700, 150)) +
      labs(title = "Distribution of Priority Number per Issue",
           subtitle = text_df_summary(summ_issue_priority_number),
           x = "Issue priority number",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_priority_number))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_priority_number
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Head Issue Priority Number"}
df_issue_priority_number %>% 
  group_by(issue_priority_number) %>% 
  summarise(score = sum(!is.na(issue_priority_number))) %>% 
  arrange(desc(score)) %>% 
  head() %>% 
  as.data.frame()
```

```{r echo=FALSE, fig.retina=3, "Distribution of Priority Number per Issue (Dropped 999 and Zoomed In to 100)"}
df_issue_priority_number <- 
  issues %>% 
    distinct(issue_id, issue_priority_number) %>% 
    filter(issue_priority_number != 999)

summ_issue_priority_number <- df_summary(df_issue_priority_number, 
                                         issue_priority_number)

plot_issue_priority_number <- 
  df_issue_priority_number %>% 
    ggplot(aes(x = issue_priority_number)) +
      geom_histogram(binwidth = 10, color = "gray", alpha = .3, 
                     boundary = summ_issue_priority_number$min, 
                     closed = "left") +
      plot_summary(df_issue_priority_number, issue_priority_number) +
      scale_x_continuous(breaks = seq(0, 280, 10)) +
      scale_y_continuous(breaks = seq(0, 1600, 150)) +
      coord_cartesian(xlim = c(0, 100)) +
      labs(title = "Distribution of Priority Number per Issue (Dropped 999)",
           subtitle = text_df_summary(summ_issue_priority_number),
           x = "Issue priority number",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_priority_number))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_priority_number
```

```{r echo=FALSE, fig.retina=3, "Distribution of Priority Number per Issue (Less than or Equal to 20)"}
df_issue_priority_number <- 
  issues %>% 
    distinct(issue_id, issue_priority_number) %>% 
    filter(issue_priority_number <= 20)

summ_issue_priority_number <- df_summary(df_issue_priority_number, 
                                         issue_priority_number)

plot_issue_priority_number <- 
  df_issue_priority_number %>% 
    ggplot(aes(x = issue_priority_number)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_issue_priority_number$min, 
                     closed = "left") +
      plot_summary(df_issue_priority_number, issue_priority_number) +
      scale_x_continuous(breaks = seq(0, 20, 1)) +
      scale_y_continuous(breaks = seq(0, 450, 50)) +
      labs(title = "Distribution of Priority Number per Issue (Less Than or Equal to 20)",
           subtitle = text_df_summary(summ_issue_priority_number),
           x = "Issue priority number",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_priority_number))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_priority_number
```

### Issue Priority Scale

```{r echo=FALSE, fig.retina=3, "Frequency of Issue Priority Scale"}
df_issue_priority_scale <-
  issues %>%
    distinct(issue_id, issue_priority_scale)

df_score_issue_priority_scale <- 
  df_issue_priority_scale %>% 
    group_by(issue_priority_scale) %>% 
    summarise(score = n()) %>% 
    arrange(desc(score))

plot_score_issue_priority_scale <- 
  df_score_issue_priority_scale %>% 
    ggplot(aes(x = issue_priority_scale, y = score/sum(score))) +
      geom_col(color = "grey", alpha = .3) +
      add_label(df_score_issue_priority_scale$score) +
      scale_y_continuous(limits = c(0, .7), breaks = seq(0, 1, .1), 
                         labels = scales::percent) + 
      labs(title = "Frequency of Issue Priority Scale",
           x = "Issue priority scale",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_priority_scale))) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1, size = 7)) 

plot_score_issue_priority_scale
```

### Issue Progress

```{r echo=FALSE, fig.retina=3, "Distribution of Progress per Issue"}
df_issue_progress <- 
  issues %>% 
    distinct(issue_id, issue_progress)

summ_issue_progress <- df_summary(df_issue_progress, 
                                         issue_progress)

plot_issue_progress <- 
  df_issue_progress %>% 
    ggplot(aes(x = issue_progress)) +
      geom_histogram(binwidth = 10, color = "gray", alpha = .3, 
                     boundary = summ_issue_progress$min, 
                     closed = "left") +
      plot_summary(df_issue_progress, issue_progress) +
      scale_x_continuous(breaks = seq(0, 100, 10)) +
      scale_y_continuous(breaks = seq(0, 4600, 500)) +
      labs(title = "Distribution of Progress per Issue",
           subtitle = text_df_summary(summ_issue_progress),
           x = "Issue progress",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_issue_progress))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_issue_progress
```

```{r echo=FALSE, message=FALSE, warning=FALSE, "Head Issue Progress"}
df_issue_progress %>% 
  group_by(issue_progress) %>% 
  summarise(score = sum(!is.na(issue_progress))) %>% 
  arrange(desc(score)) %>% 
  head() %>% 
  as.data.frame()
```

### Log Build Info

```{r echo=FALSE, fig.retina=3, "Distribution of Number of the Issues per System's Version"}
df_log_build_info <- 
  subset(issues, !is.na(log_build_info)) %>% 
    distinct(issue_id, log_build_info) %>% 
    group_by(log_build_info) %>% 
    summarise(score = n()) %>% 
    arrange(desc(score)) 

summ_log_build_info <- df_summary(df_log_build_info, score)

plot_log_build_info <- 
  df_log_build_info %>% 
    ggplot(aes(x = score)) +
      geom_histogram(binwidth = 5, color = "gray", alpha = .3, 
                     boundary = summ_log_build_info$min, 
                     closed = "left") +
      plot_summary(df_log_build_info, score) +
      scale_x_continuous(breaks = seq(1, 125, 5)) +
      scale_y_continuous(breaks = seq(0, 320, 20)) +
      labs(title = "Distribution of Number of the Issues per System's Version",
           subtitle = text_df_summary(summ_log_build_info),
           x = "Number of issues",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_log_build_info))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_log_build_info
```

```{r echo=FALSE, fig.retina=3, "Distribution of Number of the Issues per System's Version (Less Than 6 Issues)"}
df_log_build_info <- 
  subset(issues, !is.na(log_build_info)) %>% 
    distinct(issue_id, log_build_info) %>% 
    group_by(log_build_info) %>% 
    summarise(score = n()) %>% 
    arrange(desc(score)) %>% 
    filter(score < 6)

summ_log_build_info <- df_summary(df_log_build_info, score)

plot_log_build_info <- 
  df_log_build_info %>% 
    ggplot(aes(x = score)) +
      geom_histogram(binwidth = 1, color = "gray", alpha = .3, 
                     boundary = summ_log_build_info$min, 
                     closed = "left") +
      plot_summary(df_log_build_info, score) +
      scale_x_continuous(breaks = seq(1, 5, 1)) +
      scale_y_continuous(breaks = seq(0, 90, 10)) +
      labs(title = "Distribution of Number of the Issues per System's Version",
           subtitle = text_df_summary(summ_log_build_info),
           x = "Number of issues",
           y = "Frequency", 
           caption = paste0("\nNumber of observations: ",
                            nrow(df_log_build_info))) +
      theme(axis.text.x = element_text(size = 8.5)) 

plot_log_build_info
```

### Reflections on Data Set Summaries

What is the commom flow of the log states? (Data Set Structure)

What makes the demand low in 2013?
What makes the demand grow rapidly in 2014?



```{r echo=FALSE,  message=FALSE, warning=FALSE, "Clean the Environment"}
# rm(list = ls())
```