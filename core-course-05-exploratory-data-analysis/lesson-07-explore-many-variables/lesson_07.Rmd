---
title: "Lesson 7: Explore Many Variables"
author: "Dannyel Cardoso da Fonseca"  
date: "`r format(Sys.Date())`"
output: github_document
---

```{r echo=FALSE}
setwd("~/Documents/GitHub/udacity-dand/core-course-05-exploratory-data-analysis/lesson-07-explore-many-variables")
```

### Load Libraries and Datasets

```{r Load Libraries and Datasets}
library(ggplot2)
library(dplyr, warn.conflicts = FALSE)

pf <- read.delim('lesson_07_files/data/pseudo_facebook.tsv')
```
### Multivariate Data
> Note: https://www.youtube.com/watch?v=jsg6lhrJN1g

### Perceived Audience Size By Age
> Note: https://www.youtube.com/watch?v=GFKRNBnFGVU

### Third Qualitative Variable
> Note: https://www.youtube.com/watch?v=Q2M8xyY47fc

**Quiz:** Write code to create a new data frame, called 'pf.fc_by_age_gender', that contains information on each age AND gender group.

The data frame should contain the following variables:

    mean_friend_count,
    median_friend_count,
    n (the number of users in each age and gender grouping)

**Response:**
```{r Third Qualitative Variable}
pf.fc_by_age_gender <- pf %>% 
                          filter(!is.na(gender)) %>% 
                          group_by(age, gender) %>% 
                          summarise(mean_friend_count = mean(friend_count),
                                    median_friend_count = as.integer(median(friend_count)),
                                    n = n()) %>%                   
                          ungroup() %>% 
                          arrange(age, gender)

head(pf.fc_by_age_gender)
```

### Plotting Conditional Summaries
> Note: https://www.youtube.com/watch?v=8SqL0v_FSsc

**Quiz:** Create a line graph showing the median friend count over the ages for each gender. Be sure to use the data frame you just created, pf.fc_by_age_gender.

**Response:**
```{r Plotting Conditional Summaries}
ggplot(pf.fc_by_age_gender, aes(x = age, y = mean_friend_count)) +
  geom_line(aes(color = gender)) +
  scale_x_continuous(breaks = seq(10, 115, 5)) +
  scale_y_continuous(breaks = seq(0, 750, 50))
```

### Thinking In Ratios
> Note: https://www.youtube.com/watch?v=r4ZOwz3_oXs

### Wide And Long Format
> Note: https://www.youtube.com/watch?v=zlaeISxRESQ

### Reshaping Data
> Note: https://www.youtube.com/watch?v=zQj_waidR5w

```{r Reshaping Data}
library(tidyr)
pf.fc_by_age_gender.wide <- pf.fc_by_age_gender %>% 
                               select(age, gender, median_friend_count) %>% 
                               spread(gender, median_friend_count)

head(pf.fc_by_age_gender.wide)
```

### Ratio Plot
> Note: https://www.youtube.com/watch?v=gfZ7C-QBF0k

**Quiz:** Plot the ratio of the female to male median friend counts using the data frame pf.fc_by_age_gender.wide.

Think about what geom you should use. Add a horizontal line to the plot with a y intercept of 1, which will be the base line. Look up the documentation for geom_hline to do that. Use the parameter linetype in geom_hline to make the line dashed.

**Response:**
```{r Ratio Plot}
ggplot(pf.fc_by_age_gender.wide, aes(x = age, y = female/male)) +
  geom_line() +
  geom_hline(yintercept = 1, linetype = 2, alpha = .3) +
  scale_x_continuous(breaks = seq(10, 115, 5)) +
  scale_y_continuous(breaks = seq(0, 4.5, .25))
```

### Third Quantitative Variable
> Note: https://www.youtube.com/watch?v=gpwlI9Wa8xI

**Quiz:** Create a variable called year_joined in the pf data frame using the variable tenure and 2014 as the reference year.

The variable year joined should contain the year that a user joined facebook.

**Response:**
```{r Third Quantitative Variable}
pf$year_joined <- 2014 - ceiling(pf$tenure/365)

pf.fc_by_year_joined <- pf %>% 
                          filter(!is.na(year_joined)) %>% 
                          group_by(year_joined) %>% 
                          summarise(count = n())

ggplot(pf.fc_by_year_joined, aes(x = year_joined, y = count)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = count), vjust = -1, size=3) +
  scale_x_continuous(breaks = seq(2005, 2014, 1)) +
  scale_y_continuous(breaks = seq(0, 50000, 3000))
```

### Cut a Variable
> Note: https://www.youtube.com/watch?v=n0lluEhKUfQ

**Quiz:** Create a new variable in the data frame called year_joined.bucket by using the cut function on the variable year_joined.

You need to create the following buckets for the new variable, year_joined.bucket

    (2004, 2009]
    (2009, 2011]
    (2011, 2012]
    (2012, 2014]

Note that a parenthesis means exclude the year and a bracket means include the year.

**Response:**
```{r Cut a Variable}
pf$year_joined.bucket <- cut(pf$year_joined, breaks = c(2004, 2009, 2011, 2012, 2014))

unique(pf$year_joined.bucket)
```

### Plotting It All Together
> Note: https://www.youtube.com/watch?v=CiS4rBbr6tw

**Quiz:** Create a line graph of friend_count vs. age so that each year_joined.bucket is a line tracking the median user friend_count across age. This means you should have four different lines on your plot.

You should subset the data to exclude the users whose year_joined.bucket is NA.

**Response:**
```{r Plotting It All Together}
ggplot(subset(pf, !is.na(year_joined.bucket)), aes(x = age, y = friend_count)) +
  geom_line(aes(color = year_joined.bucket), stat = "summary", fun.y = median) +
  scale_x_continuous(breaks = seq(10, 120, 10)) +
  scale_y_continuous(breaks = seq(0, 2000, 100))
```

### Plot the Grand Mean
> Note: https://www.youtube.com/watch?v=pxaXkCjukGM

**Quiz:** Write code to do the following:

(1) Add another geom_line to code below to plot the grand mean of the friend count vs age.

(2) Exclude any users whose year_joined.bucket is NA.

(3) Use a different line type for the grand mean.

> As a reminder, the parameter linetype can take the values 0-6: 0 = blank, 1 = solid, 2 = dashed 3 = dotted, 4 = dotdash, 5 = longdash 6 = twodash

**Response:**
```{r Plot the Grand Mean}
ggplot(subset(pf, !is.na(year_joined.bucket)), aes(x = age, y = friend_count)) +
  geom_line(aes(color = year_joined.bucket), stat = "summary", fun.y = mean) +
  geom_line(stat = "summary", fun.y = mean, linetype = 5) + # grand mean
  scale_x_continuous(breaks = seq(10, 120, 10)) +
  scale_y_continuous(breaks = seq(0, 2000, 100))
```

